<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="the blog of sudoli">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://yoursite.com">
    <!--SEO-->





<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->


<title>notminist����Ԥ����ʾ��LogisticRegressionѵ�� | the blog of sudoli</title>


    <link rel="alternate" href="/atom.xml" title="the blog of sudoli" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
		<script type="text/javascript">
			var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
		</script>
	</div>






    

</head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(http://onq81n53u.bkt.clouddn.com/neweeess_%E5%89%AF%E6%9C%AC.png)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='sudoli'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                 <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://yoursite.com">the blog of sudoli</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>主页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/机器学习/"><i class="fa "></i>机器学习</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/深度学习/"><i class="fa "></i>深度学习</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/算法/"><i class="fa "></i>算法</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>时间轴</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="notminist����Ԥ����ʾ��LogisticRegressionѵ��">
            
	            notminist����Ԥ����ʾ��LogisticRegressionѵ��
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/����">
            ����
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
                    <a href="/tags/sklearn" title='sklearn'>
                        sklearn
                    </a>
                
                    <a href="/tags/���ѧϰ" title='���ѧϰ'>
                        ���ѧϰ
                    </a>
                
                    <a href="/tags/����ѧϰ" title='����ѧϰ'>
                        ����ѧϰ
                    </a>
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2018/08/28</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <p>[TOC]</p>
<h3 id="Ҫ��"><a href="#Ҫ��" class="headerlink" title="Ҫ��"></a>Ҫ��</h3><p>�����������notMNIST���ݼ����ص��Ƕ����ݽ���Ԥ�����漰���ݰ�����</p>
<ol>
<li>ͼ��չʾ</li>
<li>ͼ��ת��Ϊѵ������</li>
<li>���ݲ�ֳ�ѵ�������Լ���֤����</li>
<li>������ݵ�ƽ���ԣ�shuffle��������Ƿ����</li>
<li>��������ʱ��ο��ټ���ص��̶ȡ����������</li>
<li>���ô�ͳ�Ļ���ѧϰѵ��һ���򵥵ķ�����</li>
<li>����ѧϰ����</li>
</ol>
<h4 id="notMNIST-����"><a href="#notMNIST-����" class="headerlink" title="notMNIST ����"></a>notMNIST ����</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ��ҵĿ��:�ü����Է���ѵ��ͼ�������</span></span><br><span class="line"><span class="comment"># ׼������:�������ݼ�</span></span><br><span class="line"><span class="comment"># These are all the modules we'll be using later. Make sure you can import them</span></span><br><span class="line"><span class="comment"># before proceeding further.</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> display, Image</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> six.moves.urllib.request <span class="keyword">import</span> urlretrieve</span><br><span class="line"><span class="keyword">from</span> six.moves <span class="keyword">import</span> cPickle <span class="keyword">as</span> pickle</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ���ݼ����õ���notminist ���ݼ��������������ʵ�����ݼ�������mnist ���ݼ��ɾ����������Ѷ�</span></span><br><span class="line"><span class="comment"># ���ݼ���ѵ���� 500K �����Լ� 19000�������ģ��PC�����ܺܿ�</span></span><br><span class="line"><span class="comment"># ��ǩΪA �� J (10�����)</span></span><br><span class="line"><span class="comment"># ÿ��ͼ������ 28*28 ����</span></span><br><span class="line"><span class="comment"># ԭ���ݵ�ַ http://yaroslavvb.blogspot.com/2011/09/notmnist-dataset.html</span></span><br><span class="line"><span class="comment"># �����е�����ò���²�����</span></span><br><span class="line"><span class="string">""""""</span><span class="string">""""""</span><span class="string">"���������ص�����"</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span></span><br><span class="line">url = <span class="string">'https://commondatastorage.googleapis.com/books1000/'</span></span><br><span class="line">last_percent_reported = <span class="keyword">None</span></span><br><span class="line">data_root = <span class="string">'.'</span>  <span class="comment"># Change me to store data elsewhere</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ����������㱨���ع��̵ģ������˶���</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_progress_hook</span><span class="params">(count, blockSize, totalSize)</span>:</span></span><br><span class="line">    <span class="string">"""A hook to report the progress of a download. This is mostly intended for users with</span></span><br><span class="line"><span class="string">    slow internet connections. Reports every 5% change in download progress.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">global</span> last_percent_reported</span><br><span class="line">    percent = int(count * blockSize * <span class="number">100</span> / totalSize)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> last_percent_reported != percent:</span><br><span class="line">        <span class="keyword">if</span> percent % <span class="number">5</span> == <span class="number">0</span>:</span><br><span class="line">            sys.stdout.write(<span class="string">"%s%%"</span> % percent)</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            sys.stdout.write(<span class="string">"."</span>)</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">        last_percent_reported = percent</span><br><span class="line"></span><br><span class="line"><span class="comment">#����Ǹ���url �������ļ�</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maybe_download</span><span class="params">(filename, expected_bytes, force=False)</span>:</span></span><br><span class="line">    <span class="string">"""Download a file if not present, and make sure it's the right size."""</span></span><br><span class="line">    dest_filename = os.path.join(data_root, filename)</span><br><span class="line">    <span class="keyword">if</span> force <span class="keyword">or</span> <span class="keyword">not</span> os.path.exists(dest_filename):</span><br><span class="line">        print(<span class="string">'Attempting to download:'</span>, filename)</span><br><span class="line">        filename, _ = urlretrieve(url + filename, dest_filename, reporthook=download_progress_hook)</span><br><span class="line">        print(<span class="string">'\nDownload Complete!'</span>)</span><br><span class="line">    statinfo = os.stat(dest_filename)</span><br><span class="line">    <span class="keyword">if</span> statinfo.st_size == expected_bytes:</span><br><span class="line">        print(<span class="string">'Found and verified'</span>, dest_filename)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(</span><br><span class="line">            <span class="string">'Failed to verify '</span> + dest_filename + <span class="string">'. Can you get to it with a browser?'</span>)</span><br><span class="line">    <span class="keyword">return</span> dest_filename</span><br><span class="line"></span><br><span class="line"><span class="comment"># �����Ҫ���������������</span></span><br><span class="line"><span class="comment"># train_filename = maybe_download('notMNIST_large.tar.gz', 247336696)</span></span><br><span class="line"><span class="comment"># test_filename = maybe_download('notMNIST_small.tar.gz', 8458043)</span></span><br><span class="line"><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">"���ؽ���"</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""""""</span></span><br></pre></td></tr></table></figure>
<pre><code>&apos;���ؽ���&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train_filename = <span class="string">'notMNIST_large.tar.gz'</span></span><br><span class="line">test_filename = <span class="string">"notMNIST_small.tar.gz"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">""""""</span><span class="string">""""""</span><span class="string">" ��������ѹ����ļ���������Ŀ¼�������A ��J"</span><span class="string">""""""</span><span class="string">""""""</span><span class="string">""</span></span><br><span class="line"><span class="comment"># ʹ������train_filename test_filename ����ѹ</span></span><br><span class="line"><span class="comment"># ��ѹ�ǳ��ĺ�ʱ��</span></span><br><span class="line"><span class="comment"># ��ѹ�����Ŀ¼ train_folders  test_folders</span></span><br><span class="line">num_classes = <span class="number">10</span></span><br><span class="line">np.random.seed(<span class="number">133</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ��ѹtar.gz �ļ�</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maybe_extract</span><span class="params">(filename, force=False)</span>:</span></span><br><span class="line">    root = os.path.splitext(os.path.splitext(filename)[<span class="number">0</span>])[<span class="number">0</span>]  <span class="comment"># remove .tar.gz</span></span><br><span class="line">    <span class="keyword">if</span> os.path.isdir(root) <span class="keyword">and</span> <span class="keyword">not</span> force:</span><br><span class="line">        <span class="comment"># You may override by setting force=True.</span></span><br><span class="line">        print(<span class="string">'%s already present - Skipping extraction of %s.'</span> % (root, filename))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'Extracting data for %s. This may take a while. Please wait.'</span> % root)</span><br><span class="line">        tar = tarfile.open(filename)</span><br><span class="line">        sys.stdout.flush()</span><br><span class="line">        tar.extractall(data_root)</span><br><span class="line">        tar.close()</span><br><span class="line">    data_folders = [</span><br><span class="line">        os.path.join(root, d) <span class="keyword">for</span> d <span class="keyword">in</span> sorted(os.listdir(root))</span><br><span class="line">        <span class="keyword">if</span> os.path.isdir(os.path.join(root, d))]</span><br><span class="line">    <span class="keyword">if</span> len(data_folders) != num_classes:</span><br><span class="line">        <span class="keyword">raise</span> Exception(</span><br><span class="line">            <span class="string">'Expected %d folders, one per class. Found %d instead.'</span> % (</span><br><span class="line">                num_classes, len(data_folders)))</span><br><span class="line">    print(data_folders)</span><br><span class="line">    <span class="keyword">return</span> data_folders</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># train_folders = maybe_extract(train_filename)</span></span><br><span class="line"><span class="comment"># test_folders = maybe_extract(test_filename)</span></span><br><span class="line"></span><br><span class="line"><span class="string">""" �����ѹ���־ͽ����� """</span></span><br></pre></td></tr></table></figure>
<pre><code>&apos; �����ѹ���־ͽ����� &apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ��ѹ��������Եõ����Ŀ¼�б�</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"></span><br><span class="line">train_folders: List[str] = [<span class="string">'notMNIST_large/A'</span>, <span class="string">'notMNIST_large/B'</span>, <span class="string">'notMNIST_large/C'</span>, <span class="string">'notMNIST_large/D'</span>, <span class="string">'notMNIST_large/E'</span>, <span class="string">'notMNIST_large/F'</span>, <span class="string">'notMNIST_large/G'</span>, <span class="string">'notMNIST_large/H'</span>, <span class="string">'notMNIST_large/I'</span>, <span class="string">'notMNIST_large/J'</span>]</span><br><span class="line">test_folders  = [<span class="string">'notMNIST_small/A'</span>, <span class="string">'notMNIST_small/B'</span>, <span class="string">'notMNIST_small/C'</span>, <span class="string">'notMNIST_small/D'</span>, <span class="string">'notMNIST_small/E'</span>, <span class="string">'notMNIST_small/F'</span>, <span class="string">'notMNIST_small/G'</span>, <span class="string">'notMNIST_small/H'</span>, <span class="string">'notMNIST_small/I'</span>, <span class="string">'notMNIST_small/J'</span>]</span><br></pre></td></tr></table></figure>
<h4 id="����-1-չʾһЩͼ��"><a href="#����-1-չʾһЩͼ��" class="headerlink" title="���� 1: չʾһЩͼ��"></a>���� 1: չʾһЩͼ��</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""��һ����ҵ  ��ʾͼ��"""</span></span><br><span class="line"><span class="comment"># ����ʹ�� IPython.display.</span></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span>��һ����ҵ ͨ�� IPython.display չʾͼ��</span></span><br><span class="line"><span class="comment"># display(Image("notMNIST_large/A/a2F6b28udHRm.png"))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ��ÿ���������ѡȡ����ͼƬչʾ</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">showimages</span><span class="params">(num_per_class:int,train_folders)</span>:</span></span><br><span class="line">    plot_images = []  <span class="comment"># չʾ��ͼƬ</span></span><br><span class="line">    plt.figure()     <span class="comment"># ���廭ͼ</span></span><br><span class="line">    index = <span class="number">1</span>       <span class="comment"># ����Сͼ������</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(num_per_class):</span><br><span class="line">        <span class="comment"># �õ�list �е�Ԫ��</span></span><br><span class="line">        <span class="keyword">for</span> folder <span class="keyword">in</span> train_folders:</span><br><span class="line">            <span class="comment"># �г��������ļ��к����ļ�</span></span><br><span class="line">            image_files = os.listdir(folder)</span><br><span class="line">            <span class="comment"># �ֳ�num_per_class �У�len(train_folders)��</span></span><br><span class="line">            plt.subplot(num_per_class,len(train_folders),index)</span><br><span class="line">            img = plt.imread(os.path.join(folder, image_files[np.random.randint(len(image_files))]))</span><br><span class="line">            plt.imshow(img,cmap=<span class="string">'gray'</span>)</span><br><span class="line">            index = index +<span class="number">1</span></span><br><span class="line">            plt.axis(<span class="string">'off'</span>)</span><br><span class="line">    plt.show()         </span><br><span class="line"></span><br><span class="line">showimages(<span class="number">5</span>,train_folders)</span><br></pre></td></tr></table></figure>
<p><img src="https://sudl-blog-oss.oss-cn-hangzhou.aliyuncs.com/1535448522392output_5_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""�ڶ�����pillow"""</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">im = Image.open(<span class="string">"notMNIST_large/A/a2F6b28udHRm.png"</span>)</span><br><span class="line">im</span><br></pre></td></tr></table></figure>
<p><img src="https://sudl-blog-oss.oss-cn-hangzhou.aliyuncs.com/1535448524942output_6_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""��������MATLAB ��plt"""</span></span><br><span class="line">img = plt.imread(<span class="string">"notMNIST_large/A/a2F6b28udHRm.png"</span>)</span><br><span class="line">plt.imshow(img)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;matplotlib.image.AxesImage at 0x11e5e4a8&gt;
</code></pre><p><img src="https://sudl-blog-oss.oss-cn-hangzhou.aliyuncs.com/1535448525027output_7_1.png" alt="png"></p>
<h4 id="ͼ������ת����-3D-����"><a href="#ͼ������ת����-3D-����" class="headerlink" title="ͼ������ת���� 3D ����"></a>ͼ������ת���� 3D ����</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""" ���￪ʼԤ�������ݼ� """</span><span class="string">""</span></span><br><span class="line"><span class="comment"># 1. �ָ����ݣ���������û�а취ȫ�������ڴ棬�����ݼ�����ÿ����ֱ�ŵ�������</span></span><br><span class="line"><span class="comment"># 2. ���ѵ�����ݣ���ÿ�������������ϳɼ�����ڴ�ɷŵļ���</span></span><br><span class="line"><span class="comment"># 3. ��ͼƬ�����3ά�������ǰ�������ֵת���� float 3ά���� (image index, x, y) ����������£�dataset[num_images, :, :] = image_data</span></span><br><span class="line"><span class="comment"># 4. ��һ���������ݴ���� ��ֵΪ0 �������� 0.5 ����</span></span><br></pre></td></tr></table></figure>
<pre><code>&apos;&quot; ���￪ʼԤ�������ݼ� &apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image_size = <span class="number">28</span>  <span class="comment"># Pixel width and height.</span></span><br><span class="line">pixel_depth = <span class="number">255.0</span>  <span class="comment"># Number of levels per pixel.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. ��ÿ����ǩ��ͼ��ͨ��imageio.imread(image_file).astype(float)��ɶ�ά���������ڴ���</span></span><br><span class="line"><span class="comment"># 2. ���й�һ������(x-128)/255  ��0,255�� -&gt;[-128,128] -&gt;[-0.5,0.5]</span></span><br><span class="line"><span class="comment"># 3. Ȼ������[num_images, :, :]</span></span><br><span class="line"><span class="comment"># folder = A....C..F</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_letter</span><span class="params">(folder, min_num_images)</span>:</span></span><br><span class="line">    <span class="string">"""Load the data for a single letter label."""</span></span><br><span class="line">    image_files = os.listdir(folder)</span><br><span class="line">    dataset = np.ndarray(shape=(len(image_files), image_size, image_size),</span><br><span class="line">                         dtype=np.float32)</span><br><span class="line">    print(folder)</span><br><span class="line">    num_images = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> image <span class="keyword">in</span> image_files:</span><br><span class="line">        image_file = os.path.join(folder, image)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># �ⲿ�־��ǽ��й�һ�������� (x-128)/255  ��ô������� ��0,255�� -&gt;[-128,128] -&gt;[-0.5,0.5]</span></span><br><span class="line">            image_data = (imageio.imread(image_file).astype(float) -</span><br><span class="line">                          pixel_depth / <span class="number">2</span>) / pixel_depth</span><br><span class="line"></span><br><span class="line">            <span class="comment"># �жϷֱ��ʣ���С��һ�±���</span></span><br><span class="line">            <span class="keyword">if</span> image_data.shape != (image_size, image_size):</span><br><span class="line">                <span class="comment"># �����쳣�󣬺���Ĵ���Ͳ�����ִ��</span></span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">'Unexpected image shape: %s'</span> % str(image_data.shape))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># ���������ؼ��Ĵ��룬��ͼ�����ݼ��뵽dataset��</span></span><br><span class="line">            dataset[num_images, :, :] = image_data</span><br><span class="line">            num_images = num_images + <span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span> (IOError, ValueError) <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">'Could not read:'</span>, image_file, <span class="string">':'</span>, e, <span class="string">'- it\'s ok, skipping.'</span>)</span><br><span class="line"></span><br><span class="line">    dataset = dataset[<span class="number">0</span>:num_images, :, :]</span><br><span class="line">    <span class="comment"># ������ǲ������е�ͼ���Ѿ��ź���</span></span><br><span class="line">    <span class="keyword">if</span> num_images &lt; min_num_images:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'Many fewer images than expected: %d &lt; %d'</span> %</span><br><span class="line">                        (num_images, min_num_images))</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'Full dataset tensor:'</span>, dataset.shape)</span><br><span class="line">    <span class="comment"># �����ֵ</span></span><br><span class="line">    print(<span class="string">'Mean:'</span>, np.mean(dataset))</span><br><span class="line">    <span class="comment"># �����׼��</span></span><br><span class="line">    print(<span class="string">'Standard deviation:'</span>, np.std(dataset))</span><br><span class="line">    <span class="keyword">return</span> dataset</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># �־û�ÿ����ǩ�����ݼ�</span></span><br><span class="line"><span class="comment"># ��������" folder.pickle"</span></span><br><span class="line"><span class="comment"># ʹ�÷���Ϊ pickle.dump(dataset, f, pickle.HIGHEST_PROTOCOL)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maybe_pickle</span><span class="params">(data_folders, min_num_images_per_class, force=False)</span>:</span></span><br><span class="line">    dataset_names = []</span><br><span class="line">    <span class="keyword">for</span> folder <span class="keyword">in</span> data_folders:</span><br><span class="line">        <span class="comment"># ��ÿ���ļ���������A.pickle</span></span><br><span class="line">        set_filename = folder + <span class="string">'.pickle'</span></span><br><span class="line">        <span class="comment"># �����ݼ����Ƽ���dataset_names</span></span><br><span class="line">        dataset_names.append(set_filename)</span><br><span class="line">        <span class="comment"># ������ִ�е��ظ�����</span></span><br><span class="line">        <span class="keyword">if</span> os.path.exists(set_filename) <span class="keyword">and</span> <span class="keyword">not</span> force:</span><br><span class="line">            <span class="comment"># You may override by setting force=True.</span></span><br><span class="line">            print(<span class="string">'%s already present - Skipping pickling.'</span> % set_filename)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'Pickling %s.'</span> % set_filename)</span><br><span class="line">            dataset = load_letter(folder, min_num_images_per_class)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> open(set_filename, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    <span class="comment"># �������ݼ�pickle.dump</span></span><br><span class="line">                    <span class="comment"># �� obj �־û����浽�ļ� tmp.txt ��</span></span><br><span class="line">                    <span class="comment"># pickle.dump(obj, open("tmp.txt", "w"))</span></span><br><span class="line">                    <span class="comment"># obj: Ҫ�־û�����Ķ���</span></span><br><span class="line">                    <span class="comment"># file: һ��ӵ�� write() �����Ķ��󣬲������ write() �����ܽ���һ���ַ�����Ϊ������������������һ����дģʽ�򿪵��ļ��������һ��</span></span><br><span class="line">                    <span class="comment"># StringIO ���󣬻��������Զ�������������Ķ���</span></span><br><span class="line">                    <span class="comment"># protocol: ����һ����ѡ�Ĳ�����Ĭ��Ϊ 3  ���������Ϊ 4 ,��Ҫ��python �汾��3����</span></span><br><span class="line">                    <span class="comment"># ��ѹ������</span></span><br><span class="line">                    pickle.dump(dataset, f, pickle.HIGHEST_PROTOCOL)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                print(<span class="string">'Unable to save data to'</span>, set_filename, <span class="string">':'</span>, e)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dataset_names</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ���÷����������ݴ���,���Ĳ����ظ�ִ��</span></span><br><span class="line">train_datasets = maybe_pickle(train_folders, <span class="number">45000</span>)</span><br><span class="line">test_datasets = maybe_pickle(test_folders, <span class="number">1800</span>)</span><br></pre></td></tr></table></figure>
<pre><code>notMNIST_large/A.pickle already present - Skipping pickling.
notMNIST_large/B.pickle already present - Skipping pickling.
notMNIST_large/C.pickle already present - Skipping pickling.
notMNIST_large/D.pickle already present - Skipping pickling.
notMNIST_large/E.pickle already present - Skipping pickling.
notMNIST_large/F.pickle already present - Skipping pickling.
notMNIST_large/G.pickle already present - Skipping pickling.
notMNIST_large/H.pickle already present - Skipping pickling.
notMNIST_large/I.pickle already present - Skipping pickling.
notMNIST_large/J.pickle already present - Skipping pickling.
notMNIST_small/A.pickle already present - Skipping pickling.
notMNIST_small/B.pickle already present - Skipping pickling.
notMNIST_small/C.pickle already present - Skipping pickling.
notMNIST_small/D.pickle already present - Skipping pickling.
notMNIST_small/E.pickle already present - Skipping pickling.
notMNIST_small/F.pickle already present - Skipping pickling.
notMNIST_small/G.pickle already present - Skipping pickling.
notMNIST_small/H.pickle already present - Skipping pickling.
notMNIST_small/I.pickle already present - Skipping pickling.
notMNIST_small/J.pickle already present - Skipping pickling.
</code></pre><h4 id="����-2-��֤��һ����ͼ��"><a href="#����-2-��֤��һ����ͼ��" class="headerlink" title="���� 2: ��֤��һ����ͼ��"></a>���� 2: ��֤��һ����ͼ��</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># <span class="doctag">TODO:</span>�ڶ�����ҵ ͨ��չʾ��һ�����ͼ���Լ���ǩ ��ʾ�������ʹ��matplotlib.pyplot��չʾͼ��</span></span><br><span class="line"><span class="comment"># ��ΰ�pickle �����ڴ���</span></span><br><span class="line">pickle_file_path = <span class="string">"notMNIST_large/B.pickle"</span></span><br><span class="line">f = open(pickle_file_path, <span class="string">'rb'</span>)</span><br><span class="line">letter_set = pickle.load(f)</span><br><span class="line">index = np.random.randint(<span class="number">0</span>,<span class="number">45000</span>)</span><br><span class="line">plt.imshow(letter_set[index,:,:])</span><br></pre></td></tr></table></figure>
<pre><code>&lt;matplotlib.image.AxesImage at 0xf86ae10&gt;
</code></pre><p><img src="https://sudl-blog-oss.oss-cn-hangzhou.aliyuncs.com/1535448525118output_13_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> pickle_file <span class="keyword">in</span> train_datasets:</span><br><span class="line">    print(pickle_file)</span><br></pre></td></tr></table></figure>
<pre><code>notMNIST_large/A.pickle
notMNIST_large/B.pickle
notMNIST_large/C.pickle
notMNIST_large/D.pickle
notMNIST_large/E.pickle
notMNIST_large/F.pickle
notMNIST_large/G.pickle
notMNIST_large/H.pickle
notMNIST_large/I.pickle
notMNIST_large/J.pickle
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ��չʾһЩ��һ�����pickleͼ��,</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">��num_per_class:int ÿ����չʾ����ͼ��</span></span><br><span class="line"><span class="string">train_datasets  ����pickle �����Ƶ�list</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">showimages_pickle</span><span class="params">(num_per_class:int,train_datasets)</span>:</span></span><br><span class="line">    plot_images = []  <span class="comment"># չʾ��ͼƬ</span></span><br><span class="line">    plt.figure()     <span class="comment"># ���廭ͼ</span></span><br><span class="line">    index = <span class="number">1</span>       <span class="comment"># ����Сͼ������</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(num_per_class):</span><br><span class="line">        <span class="comment"># �õ�list �е�Ԫ��</span></span><br><span class="line">        <span class="keyword">for</span> pickle_file <span class="keyword">in</span> train_datasets:</span><br><span class="line">            <span class="comment"># ����pickle ���ļ�</span></span><br><span class="line">            f = open(pickle_file, <span class="string">'rb'</span>)</span><br><span class="line">            image_data_per_class = pickle.load(f)</span><br><span class="line">            <span class="comment"># �ֳ�num_per_class �У�len(train_folders)��</span></span><br><span class="line">            plt.subplot(num_per_class,len(train_datasets),index)</span><br><span class="line">            plt.imshow( image_data_per_class[np.random.randint(np.shape(image_data_per_class)[<span class="number">0</span>])],cmap=<span class="string">'gray'</span>)</span><br><span class="line">            index = index +<span class="number">1</span></span><br><span class="line">            plt.axis(<span class="string">'off'</span>)</span><br><span class="line">    plt.show()         </span><br><span class="line"></span><br><span class="line">showimages_pickle(<span class="number">5</span>,train_datasets)</span><br></pre></td></tr></table></figure>
<p><img src="https://sudl-blog-oss.oss-cn-hangzhou.aliyuncs.com/1535448525183output_15_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># �ڶ��� ͨ��IPython.displayչʾ</span></span><br><span class="line">index = np.random.randint(<span class="number">0</span>,<span class="number">45000</span>)</span><br><span class="line"><span class="comment"># ����IPython.display���Ҳ�֪���������ͼ�񣬲�֪��˭��</span></span><br></pre></td></tr></table></figure>
<h4 id="����-3-��֤����ƽ��"><a href="#����-3-��֤����ƽ��" class="headerlink" title="���� 3: ��֤����ƽ��"></a>���� 3: ��֤����ƽ��</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># <span class="doctag">TODO:</span>��������ҵ ��������֮��������Ƿ�ƽ��</span></span><br><span class="line"><span class="comment"># ����Ϊƽ�����ÿ������������Ƿ�һ��</span></span><br><span class="line"><span class="comment"># �����������ˣ�</span></span><br><span class="line"><span class="comment"># �����е����ݼ����ζ�������Ȼ��������״ͼ��ʾ����</span></span><br><span class="line">labels = []</span><br><span class="line">num_of_labels = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># enumerate ö�� �ɷ�������������һ����������һ�����ļ�</span></span><br><span class="line"><span class="keyword">for</span> label, pickle_file <span class="keyword">in</span> enumerate(train_datasets):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> open(pickle_file, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            letter_set = pickle.load(f)</span><br><span class="line">            num = np.shape(letter_set)[<span class="number">0</span>]</span><br><span class="line">            num_of_labels.append(num)</span><br><span class="line">            labels.append(label)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'Unable to process data from'</span>, pickle_file, <span class="string">':'</span>, e)</span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plt.bar(range(len(num_of_labels)), num_of_labels,color=<span class="string">'rgb'</span>,tick_label=labels)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;BarContainer object of 10 artists&gt;
</code></pre><p><img src="https://sudl-blog-oss.oss-cn-hangzhou.aliyuncs.com/1535448525281output_17_1.png" alt="png"></p>
<h4 id="������ݼ�����"><a href="#������ݼ�����" class="headerlink" title="������ݼ�����"></a>������ݼ�����</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ���ڼ���ĵ�����û�а취װ�����е����ã�����ֻ�ܲ����ó�������ϳ��Լ���Ҫ�����ݼ���С������Ҫ������Ҫ�������ݼ��Ĵ�С</span></span><br><span class="line"><span class="comment"># ��ʼ������ dataset (3ά����)��labels(1ά����)���ڴ�����ݣ�</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_arrays</span><span class="params">(nb_rows, img_size)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> nb_rows:</span><br><span class="line">        <span class="comment"># ndarray ����3ά����</span></span><br><span class="line">        dataset = np.ndarray((nb_rows, img_size, img_size), dtype=np.float32)</span><br><span class="line">        labels = np.ndarray(nb_rows, dtype=np.int32)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        dataset, labels = <span class="keyword">None</span>, <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">return</span> dataset, labels</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ��һ���������� A.pickle B.pickle</span></span><br><span class="line"><span class="comment"># �ڶ����������� ����ѵ�����Ĵ�С</span></span><br><span class="line"><span class="comment"># �����ܹ�ѡ�� train_size = 200000 �����ݣ���ô����ÿ���� ѡ�� ��200000/ 10�ࣩ�����ݣ���ϼ���</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge_datasets</span><span class="params">(pickle_files, train_size, valid_size=<span class="number">0</span>)</span>:</span></span><br><span class="line">    num_classes = len(pickle_files)</span><br><span class="line">    <span class="comment"># ���valid_size = 0����ô��������valid_dataset =None</span></span><br><span class="line">    valid_dataset, valid_labels = make_arrays(valid_size, image_size)</span><br><span class="line">    train_dataset, train_labels = make_arrays(train_size, image_size)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ���Լ��Ĵ�С ��ע������� //</span></span><br><span class="line">    <span class="comment"># ��֤���Ĵ�С</span></span><br><span class="line">    vsize_per_class = valid_size // num_classes</span><br><span class="line">    tsize_per_class = train_size // num_classes</span><br><span class="line"></span><br><span class="line">    start_v, start_t = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    end_v, end_t = vsize_per_class, tsize_per_class</span><br><span class="line">    end_l = vsize_per_class + tsize_per_class</span><br><span class="line">    <span class="comment"># enumerate ö�� �ɷ�������������һ����������һ�����ļ�</span></span><br><span class="line">    <span class="keyword">for</span> label, pickle_file <span class="keyword">in</span> enumerate(pickle_files):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> open(pickle_file, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                letter_set = pickle.load(f)</span><br><span class="line">                <span class="comment"># let's shuffle the letters to have random validation and training set</span></span><br><span class="line">                <span class="comment"># ���ϴ��</span></span><br><span class="line">                np.random.shuffle(letter_set)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># �����ݷֳ������֣���һ���ָ� ��֤��valid �ڶ����� ���Լ� train��ÿ����ѡһ���֣�����������ݼ�</span></span><br><span class="line">                <span class="keyword">if</span> valid_dataset <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">                    valid_letter = letter_set[:vsize_per_class, :, :]</span><br><span class="line">                    valid_dataset[start_v:end_v, :, :] = valid_letter</span><br><span class="line">                    valid_labels[start_v:end_v] = label</span><br><span class="line">                    start_v += vsize_per_class</span><br><span class="line">                    end_v += vsize_per_class</span><br><span class="line"></span><br><span class="line">                train_letter = letter_set[vsize_per_class:end_l, :, :]</span><br><span class="line">                train_dataset[start_t:end_t, :, :] = train_letter</span><br><span class="line">                train_labels[start_t:end_t] = label</span><br><span class="line">                start_t += tsize_per_class</span><br><span class="line">                end_t += tsize_per_class</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">'Unable to process data from'</span>, pickle_file, <span class="string">':'</span>, e)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> valid_dataset, valid_labels, train_dataset, train_labels</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Optional</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> numpy.core.multiarray <span class="keyword">import</span> ndarray</span><br><span class="line"></span><br><span class="line">train_size = <span class="number">20000</span></span><br><span class="line">valid_size = <span class="number">1000</span></span><br><span class="line">test_size = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">valid_dataset, valid_labels, train_dataset, train_labels = merge_datasets(</span><br><span class="line">    train_datasets, train_size, valid_size)</span><br><span class="line">_, _, test_dataset, test_labels = merge_datasets(test_datasets, test_size)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Training:'</span>, train_dataset.shape, train_labels.shape)</span><br><span class="line">print(<span class="string">'Validation:'</span>, valid_dataset.shape, valid_labels.shape)</span><br><span class="line">print(<span class="string">'Testing:'</span>, test_dataset.shape, test_labels.shape)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ������Ƕ����õ����ݼ�����ϴ��</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomize</span><span class="params">(dataset, labels)</span>:</span></span><br><span class="line">  <span class="comment"># ��ȡlabel������</span></span><br><span class="line">  permutation = np.random.permutation(labels.shape[<span class="number">0</span>])</span><br><span class="line">  <span class="comment"># �����������������dataset �Լ� label</span></span><br><span class="line">  shuffled_dataset = dataset[permutation,:,:]</span><br><span class="line">  shuffled_labels = labels[permutation]</span><br><span class="line">  <span class="keyword">return</span> shuffled_dataset, shuffled_labels</span><br><span class="line">train_dataset, train_labels = randomize(train_dataset, train_labels)</span><br><span class="line">test_dataset, test_labels = randomize(test_dataset, test_labels)</span><br><span class="line">valid_dataset, valid_labels = randomize(valid_dataset, valid_labels)</span><br></pre></td></tr></table></figure>
<pre><code>Training: (20000, 28, 28) (20000,)
Validation: (1000, 28, 28) (1000,)
Testing: (1000, 28, 28) (1000,)
</code></pre><h4 id="����-4-������������֤"><a href="#����-4-������������֤" class="headerlink" title="���� 4: ������������֤"></a>���� 4: ������������֤</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Problem 4</span></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span>���ĸ���ҵ ˵���Լ�ϴ�ƺ�����ݺܺ�</span></span><br><span class="line"><span class="comment"># ��������֤������ƽ���ԣ�Ȼ����״ͼչʾ</span></span><br><span class="line"><span class="comment"># ˼·��ȡ��ǩ�е�ÿһ��ĸ�����Ȼ�󻭳���״ͼ</span></span><br><span class="line"><span class="comment"># a = np.where(valid_labels==3) ����</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">showbalance</span><span class="params">(labels)</span>:</span></span><br><span class="line">    num_of_labels = []</span><br><span class="line">    <span class="keyword">for</span> label <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        <span class="comment"># �������и����ʣ�Ϊʲôlabel_per_class.shape �����ã�����������</span></span><br><span class="line">        label_per_class = np.where(labels==label)</span><br><span class="line">        num_of_labels.append(np.shape(label_per_class)[<span class="number">1</span>])</span><br><span class="line">    </span><br><span class="line">    plt.bar(range(len(num_of_labels)), num_of_labels,color=<span class="string">'rgbcy'</span>,tick_label=range(len(num_of_labels)))</span><br><span class="line">    <span class="keyword">return</span> num_of_labels</span><br><span class="line"></span><br><span class="line">showbalance(valid_labels)</span><br></pre></td></tr></table></figure>
<pre><code>[100, 100, 100, 100, 100, 100, 100, 100, 100, 100]
</code></pre><p><img src="https://sudl-blog-oss.oss-cn-hangzhou.aliyuncs.com/1535448525347output_21_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># <span class="doctag">TODO:</span>���ĸ���ҵ �����Ƿ��Ѿ�������ң����Һ�ı�ǩ�Ƿ���ȷ</span></span><br><span class="line"><span class="comment"># ˼·���ѡ��num_start����ʼ�㣬Ȼ������ѡ��num_pic��ͼƬ�ͱ�ǩȻ��չʾ</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_pic_and_label</span><span class="params">(dataset,labels,num_start,num_pic)</span>:</span></span><br><span class="line">    plt.figure()</span><br><span class="line">    index = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num_start):</span><br><span class="line">        start = np.random.randint(len(labels)-num_pic)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(num_pic):</span><br><span class="line">            plt.subplot(num_start,num_pic,index)</span><br><span class="line">            plt.imshow(dataset[start+j,:,:],cmap=<span class="string">'gray'</span>)</span><br><span class="line">            plt.title(labels[start+j])</span><br><span class="line">            index = index +<span class="number">1</span></span><br><span class="line">            plt.axis(<span class="string">'off'</span>)</span><br><span class="line">    plt.show()         </span><br><span class="line"></span><br><span class="line">show_pic_and_label(train_dataset, train_labels,<span class="number">5</span>,<span class="number">20</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://sudl-blog-oss.oss-cn-hangzhou.aliyuncs.com/1535448525439output_22_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># �����ݴ洢����׼��ʹ��</span></span><br><span class="line"><span class="comment"># �ϳ�·�� os.path.join</span></span><br><span class="line"><span class="comment"># 1.open(pickle_file, 'wb')</span></span><br><span class="line"><span class="comment"># 2.�����ݼ���ϳɼ�ֵ��</span></span><br><span class="line"><span class="comment"># 3.pickle.dump(save, f, pickle.HIGHEST_PROTOCOL) �������</span></span><br><span class="line">pickle_file = os.path.join(data_root, <span class="string">'notMNIST.pickle'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  f = open(pickle_file, <span class="string">'wb'</span>)</span><br><span class="line">  save = &#123;</span><br><span class="line">    <span class="string">'train_dataset'</span>: train_dataset,</span><br><span class="line">    <span class="string">'train_labels'</span>: train_labels,</span><br><span class="line">    <span class="string">'valid_dataset'</span>: valid_dataset,</span><br><span class="line">    <span class="string">'valid_labels'</span>: valid_labels,</span><br><span class="line">    <span class="string">'test_dataset'</span>: test_dataset,</span><br><span class="line">    <span class="string">'test_labels'</span>: test_labels,</span><br><span class="line">    &#125;</span><br><span class="line">  pickle.dump(save, f, pickle.HIGHEST_PROTOCOL)</span><br><span class="line">  f.close()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">  print(<span class="string">'Unable to save data to'</span>, pickle_file, <span class="string">':'</span>, e)</span><br><span class="line">  <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ����ϵͳ��ȡ�ļ������������õ��ļ���С</span></span><br><span class="line">statinfo = os.stat(pickle_file)</span><br><span class="line">print(<span class="string">'Compressed pickle size:'</span>, statinfo.st_size)</span><br></pre></td></tr></table></figure>
<pre><code>Compressed pickle size: 69080502
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">localtime = time.asctime( time.localtime(time.time()) )</span><br><span class="line">print( time.asctime( time.localtime(time.time()) ))</span><br></pre></td></tr></table></figure>
<pre><code>Tue Aug 28 15:21:49 2018
</code></pre><h4 id="����-5-Ѱ���ص�����"><a href="#����-5-Ѱ���ص�����" class="headerlink" title="���� 5: Ѱ���ص�����"></a>���� 5: Ѱ���ص�����</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># <span class="doctag">TODO:</span>��ҵ�� ����ѵ������ �� ������֤���� ����غϳ̶�</span></span><br><span class="line"><span class="comment"># �غ϶ȸ����׵��¹��������</span></span><br><span class="line"><span class="comment"># �����������ŷʽ���룬�ж�ͼ���Ƿ����ƣ�</span></span><br><span class="line"><span class="comment"># dist = numpy.sqrt(numpy.sum(numpy.square(vec1 - vec2)))</span></span><br><span class="line"><span class="comment"># dist = numpy.linalg.norm(vec1 - vec2)</span></span><br><span class="line"><span class="comment"># ���������� cosine_sim = np.inner(X, Y) / np.inner(np.abs(X), np.abs(Y))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">overlap</span><span class="params">(train_dataset,valid_dataset,threshold=<span class="number">0</span>,num_duplicate_to_show = <span class="number">5</span>)</span>:</span></span><br><span class="line">    print(<span class="string">"��ʼ---&gt;"</span>,)</span><br><span class="line">    num_overlap = <span class="number">0</span>     <span class="comment">#   ���Ǹ���</span></span><br><span class="line">    print_pic_num = <span class="number">0</span>;  <span class="comment">#   ��ӡͼƬ����</span></span><br><span class="line">    index = <span class="number">1</span>;</span><br><span class="line">    plt.figure()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(train_dataset.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(valid_dataset.shape[<span class="number">0</span>]):</span><br><span class="line">            dist = np.linalg.norm(train_dataset[i,:,:]-valid_dataset[j,:,:])</span><br><span class="line">            <span class="keyword">if</span> dist &lt;= threshold:</span><br><span class="line">                num_overlap = num_overlap + <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span>(print_pic_num&lt;=num_duplicate_to_show):</span><br><span class="line">                    <span class="comment"># ��train_dataset��һ��ͼ</span></span><br><span class="line">                    plt.subplot(num_duplicate_to_show,<span class="number">2</span>,index)</span><br><span class="line">                    plt.title(<span class="string">"train_dataset"</span>)</span><br><span class="line">                    plt.imshow(train_dataset[i,:,:],cmap=<span class="string">'gray'</span>)</span><br><span class="line">                    index = index +<span class="number">1</span></span><br><span class="line">                    <span class="comment"># ��valid_dataset��һ��ͼ</span></span><br><span class="line">                    plt.subplot(num_duplicate_to_show,<span class="number">2</span>,index)</span><br><span class="line">                    plt.title(<span class="string">"valid_dataset"</span>)</span><br><span class="line">                    plt.imshow(valid_dataset[j,:,:],cmap=<span class="string">'gray'</span>)</span><br><span class="line">                    print_pic_num = print_pic_num + <span class="number">1</span></span><br><span class="line">                    index = index +<span class="number">1</span></span><br><span class="line">    print(<span class="string">"�غ����ݸ����ǣ�"</span>,num_overlap)</span><br><span class="line">    print(<span class="string">"train_dataset�غ����ǣ�"</span>,num_overlap/train_dataset.shape[<span class="number">0</span>])</span><br><span class="line">    print(<span class="string">"valid_dataset�غ����ǣ�"</span>,num_overlap/valid_dataset.shape[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> num_overlap</span><br><span class="line"></span><br><span class="line">overlap(train_dataset,valid_dataset,threshold=<span class="number">0</span>,num_duplicate_to_show = <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<pre><code>��ʼ---&gt;


C:\Users\Administrator\AppData\Local\Programs\Python\Python36\lib\site-packages\matplotlib\cbook\deprecation.py:107: MatplotlibDeprecationWarning: Adding an axes using the same arguments as a previous axes currently reuses the earlier instance.  In a future version, a new instance will always be created and returned.  Meanwhile, this warning can be suppressed, and the future behavior ensured, by passing a unique label to each axes instance.
  warnings.warn(message, mplDeprecation, stacklevel=1)


�غ����ݸ����ǣ� 213540
train_dataset�غ����ǣ� 1.0677
valid_dataset�غ����ǣ� 21.354





213540
</code></pre><p><img src="https://sudl-blog-oss.oss-cn-hangzhou.aliyuncs.com/1535448525542output_25_4.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">overlap_cos_matrix</span><span class="params">(source_dataset,target_dataset,threshold=<span class="number">1</span>,num_duplicate_to_show = <span class="number">5</span>,selfcheck = False)</span>:</span></span><br><span class="line">    print(<span class="string">"��ʼʱ�䣺"</span>,time.asctime( time.localtime(time.time()) ))</span><br><span class="line">    X = np.reshape(source_dataset,(source_dataset.shape[<span class="number">0</span>],<span class="number">-1</span>))</span><br><span class="line">    Y = np.reshape(target_dataset,(target_dataset.shape[<span class="number">0</span>],<span class="number">-1</span>))</span><br><span class="line">    <span class="keyword">assert</span> (X.shape[<span class="number">1</span>] == Y.shape[<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># �����������ƶȣ�ע�������Ǿ������ </span></span><br><span class="line">    cosine_sim = np.dot(X, Y.T) / np.inner(np.abs(X), np.abs(Y))</span><br><span class="line">    <span class="keyword">assert</span> (cosine_sim.shape == (X.shape[<span class="number">0</span>],Y.shape[<span class="number">0</span>]))</span><br><span class="line">    print(cosine_sim.shape)</span><br><span class="line">    <span class="comment"># �ж�cosine_sim�е�Ԫ���Ƿ��е���threshold�ģ�����о������</span></span><br><span class="line">    num_source = <span class="number">0</span></span><br><span class="line">    num_target = <span class="number">0</span></span><br><span class="line">    print_pic_num = <span class="number">1</span>;</span><br><span class="line">    plt.figure()</span><br><span class="line">    print(<span class="string">"������������"</span>,time.asctime( time.localtime(time.time()) ))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(X.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="comment"># ��i ���������ظ���ͼƬ����</span></span><br><span class="line">        dup_indices = np.where(cosine_sim[i,:] &gt;= threshold)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> dup_indices[<span class="number">0</span>]:</span><br><span class="line">            <span class="keyword">if</span> i==j <span class="keyword">and</span> selfcheck:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                num_source = num_source +<span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span>(print_pic_num&lt;=num_duplicate_to_show):</span><br><span class="line">                    <span class="comment"># ��train_dataset��һ��ͼ</span></span><br><span class="line">                    plt.subplot(num_duplicate_to_show,<span class="number">2</span>,print_pic_num)</span><br><span class="line">                    plt.imshow(source_dataset[i,:,:],cmap=<span class="string">'gray'</span>)</span><br><span class="line">                    print_pic_num = print_pic_num +<span class="number">1</span></span><br><span class="line">                    <span class="comment"># ��valid_dataset��һ��ͼ</span></span><br><span class="line">                    plt.subplot(num_duplicate_to_show,<span class="number">2</span>,print_pic_num)</span><br><span class="line">                    plt.imshow(target_dataset[j,:,:],cmap=<span class="string">'gray'</span>)</span><br><span class="line">                    print_pic_num = print_pic_num + <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(<span class="string">"����ʱ�䣺"</span>,time.asctime( time.localtime(time.time()) ))</span><br><span class="line">    print(<span class="string">"�غ����ݸ����ǣ�"</span>,num_source)</span><br><span class="line">    print(<span class="string">"train_dataset�غ����ǣ�"</span>,num_source/source_dataset.shape[<span class="number">0</span>])</span><br><span class="line">    <span class="comment"># print("valid_dataset�غ����ǣ�",num_overlap/valid_dataset.shape[0])</span></span><br><span class="line">    plt.axis(<span class="string">'off'</span>)</span><br><span class="line">    plt.show()</span><br><span class="line">    <span class="keyword">return</span> num_source</span><br><span class="line">        </span><br><span class="line">overlap_cos_matrix(valid_dataset,train_dataset,threshold=<span class="number">1</span>,num_duplicate_to_show = <span class="number">10</span>,selfcheck = <span class="keyword">False</span>)</span><br></pre></td></tr></table></figure>
<pre><code>��ʼʱ�䣺 Tue Aug 28 15:55:19 2018
(1000, 20000)
������������ Tue Aug 28 15:55:20 2018
����ʱ�䣺 Tue Aug 28 15:55:20 2018
�غ����ݸ����ǣ� 47
train_dataset�غ����ǣ� 0.047
</code></pre><p><img src="https://sudl-blog-oss.oss-cn-hangzhou.aliyuncs.com/1535448525630output_26_1.png" alt="png"></p>
<pre><code>47
</code></pre><h4 id="����-6-ѵ��һ���򵥵L���ѧϰg��"><a href="#����-6-ѵ��һ���򵥵L���ѧϰg��" class="headerlink" title="���� 6: ѵ��һ���򵥵Ļ���ѧϰģ��"></a>���� 6: ѵ��һ���򵥵Ļ���ѧϰģ��</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># <span class="doctag">TODO:</span>��ҵ�� ��֤���Լ��ڲ����ظ�ͼƬ�ж��٣�</span></span><br><span class="line">res = overlap_cos_matrix(valid_dataset,valid_dataset,threshold=<span class="number">1</span>,num_duplicate_to_show = <span class="number">10</span>,selfcheck = <span class="keyword">True</span>)</span><br><span class="line"><span class="comment"># ÿ��ͼ�񶼺��Լ��ص�</span></span><br><span class="line">res = res - valid_dataset.shape[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<pre><code>��ʼʱ�䣺 Tue Aug 28 15:55:23 2018
(1000, 1000)
������������ Tue Aug 28 15:55:23 2018
����ʱ�䣺 Tue Aug 28 15:55:23 2018
�غ����ݸ����ǣ� 16
train_dataset�غ����ǣ� 0.016
</code></pre><p><img src="https://sudl-blog-oss.oss-cn-hangzhou.aliyuncs.com/1535448525746output_27_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ��չһ������ж�����ͼ�Ƿ������أ�����ͨ������Ĵ��롪��ֱ��ͼ���ƶ�</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">difference</span><span class="params">(hist1,hist2)</span>:</span></span><br><span class="line">    sum1 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(hist1)):</span><br><span class="line">       <span class="keyword">if</span> (hist1[i] == hist2[i]):</span><br><span class="line">          sum1 += <span class="number">1</span></span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           sum1 += <span class="number">1</span> - float(abs(hist1[i] - hist2[i]))/ max(hist1[i], hist2[i])</span><br><span class="line">    <span class="keyword">return</span> sum1/len(hist1)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">similary_calculate</span><span class="params">(img1, img2)</span>:</span></span><br><span class="line">        img1_reshape = np.reshape(img1, (<span class="number">28</span> * <span class="number">28</span>, <span class="number">1</span>))</span><br><span class="line">        img1_reshape = np.reshape(img2, (<span class="number">28</span> * <span class="number">28</span>, <span class="number">1</span>))</span><br><span class="line">        hist1 = list(img1_reshape.getdata())</span><br><span class="line">        hist2 = list(img1_reshape.getdata())</span><br><span class="line">        <span class="keyword">return</span> difference(hist1, hist2)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># <span class="doctag">TODO:</span>��ҵ�� ����һ���������Ĳ����Լ���֤�� �Ƚ������ں�����ҵ��׼ȷ��</span></span><br><span class="line"><span class="comment"># ˼·һ: ��Ŀǰ�������� </span></span><br><span class="line"><span class="comment"># 1. ����trainset��pickle����ظ��ģ�����ظ���ɾ��</span></span><br><span class="line"><span class="comment"># 2. validateset��pickle����ظ��ģ�����ظ���ɾ��</span></span><br><span class="line"><span class="comment"># 3. test��pickle ����ظ��ģ��ظ���ɾ��</span></span><br><span class="line"><span class="comment"># 4. train �� valid ���ظ��ģ���valid ɾ��</span></span><br><span class="line"><span class="comment"># 5. train ��test ���ظ��ģ���test ɾ��</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ˼·������ͷ��</span></span><br><span class="line"><span class="comment"># 1. ��ͼ�����ݰ�������ظ��ģ�ÿ��ͼ�����������ͼ��ƥ�䣬�ظ���ɾ��</span></span><br><span class="line"><span class="comment"># 2. ����ִ�� ת��3D���ݣ���һ������ֳ���ϳ�������</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># <span class="doctag">TODO:</span>��ҵ�� using 50, 100, 1000 and 5000 training samples����sklearn ѵ��һ��ģ��</span></span><br><span class="line"><span class="comment"># ��ʾʹ��sklearn ��  linear_model.LogisticRegression()</span></span><br><span class="line"><span class="comment"># ˼·һ��ֱ����ѧϰ���ߣ���������ֺõ���֤��</span></span><br><span class="line"><span class="comment"># from sklearn.model_selection import learning_curve #ѧϰ����ģ��</span></span><br><span class="line"><span class="comment"># from sklearn.linear_model import LogisticRegression</span></span><br><span class="line"><span class="comment"># from sklearn.model_selection import ShuffleSplit # רҵ�����ݼ��ָ��</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># X = train_dataset.reshape(train_dataset.shape[0],-1)</span></span><br><span class="line"><span class="comment"># y = train_labels</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># train_sizes, train_scores, test_scores= learning_curve(</span></span><br><span class="line"><span class="comment">#     model, X, y,cv=5  train_sizes=[50,100,1000,5000],n_jobs=5)</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># train_scores</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ˼·�����Լ���Ԥ�⣬�Լ���ѧϰ���ߣ�������ֺõ���֤��</span></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> learning_curve <span class="comment">#ѧϰ����ģ��</span></span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> ShuffleSplit <span class="comment"># רҵ�����ݼ��ָ��</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># train_dataset, train_labels = randomize(train_dataset, train_labels)</span></span><br><span class="line"><span class="comment"># test_dataset, test_labels = randomize(test_dataset, test_labels)</span></span><br><span class="line"><span class="comment"># valid_dataset, valid_labels = randomize(valid_dataset, valid_labels)</span></span><br><span class="line"></span><br><span class="line">train_size=[<span class="number">50</span>,<span class="number">100</span>,<span class="number">1000</span>,<span class="number">5000</span>,<span class="number">8000</span>,<span class="number">15000</span>,<span class="number">20000</span>]</span><br><span class="line">train_scores = []</span><br><span class="line">valid_scores = []</span><br><span class="line">test_scores  = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> size <span class="keyword">in</span> train_size:</span><br><span class="line">    <span class="comment"># ÿ��ѭ����Ҫ�½�ģ�ͣ�solver�ʺ����ݽ϶��������ȽϿ�</span></span><br><span class="line">    model = LogisticRegression(solver= <span class="string">'saga'</span>,multi_class=<span class="string">'multinomial'</span>)</span><br><span class="line">    <span class="comment"># ����train_dataset�������Ѿ������ˣ����԰�˳����</span></span><br><span class="line">    X = train_dataset[<span class="number">0</span>:size,:].reshape(size,<span class="number">-1</span>)</span><br><span class="line">    y = train_labels[<span class="number">0</span>:size]</span><br><span class="line">    X_valid = valid_dataset.reshape(valid_dataset.shape[<span class="number">0</span>],<span class="number">-1</span>)</span><br><span class="line">    y_valid = valid_labels</span><br><span class="line">    X_test = test_dataset.reshape(test_dataset.shape[<span class="number">0</span>],<span class="number">-1</span>)</span><br><span class="line">    y_test = test_labels</span><br><span class="line">    </span><br><span class="line">    model.fit(X,y)</span><br><span class="line">    train_scores.append(model.score(X,y))</span><br><span class="line">    valid_scores.append(model.score(X_valid,y_valid))</span><br><span class="line">    test_scores.append(model.score(X_test,y_test))</span><br></pre></td></tr></table></figure>
<pre><code>C:\Users\Administrator\AppData\Local\Programs\Python\Python36\lib\site-packages\sklearn\linear_model\sag.py:326: ConvergenceWarning: The max_iter was reached which means the coef_ did not converge
  &quot;the coef_ did not converge&quot;, ConvergenceWarning)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># axis=1 ���н��в��������������cv=�ֳ���20�ݣ����� train_scores ��һ��20��Ԫ�ص�����</span></span><br><span class="line"><span class="comment"># train_scores_mean = np.mean(train_scores, axis=1)</span></span><br><span class="line"><span class="comment"># valid_scores_mean = np.mean(valid_scores, axis=1)</span></span><br><span class="line"><span class="comment"># test_scores_mean =  np.mean(test_scores, axis=1)</span></span><br><span class="line"><span class="comment"># train_sizes �����꣬train_loss_mean �����꣬��״��o-��,��ɫ</span></span><br><span class="line">plt.plot(train_size, train_scores, <span class="string">'o-'</span>, color=<span class="string">"r"</span>,</span><br><span class="line">         label=<span class="string">"Training"</span>)</span><br><span class="line">plt.plot(train_size, valid_scores, <span class="string">'o-'</span>, color=<span class="string">"b"</span>,</span><br><span class="line">        label=<span class="string">"Cross-validation"</span>)</span><br><span class="line">plt.plot(train_size, test_scores, <span class="string">'o-'</span>, color=<span class="string">"g"</span>,</span><br><span class="line">        label=<span class="string">"test"</span>)</span><br><span class="line"></span><br><span class="line">plt.xlabel(<span class="string">"Training examples"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Loss"</span>)</span><br><span class="line"><span class="comment"># ��ͼ��ǩ����ͼ���ŵ���ѵ�λ��</span></span><br><span class="line">plt.legend(loc=<span class="string">"best"</span>)</span><br><span class="line">title = <span class="string">"Learning Curves"</span></span><br><span class="line">plt.title(title)</span><br></pre></td></tr></table></figure>
<pre><code>Text(0.5,1,&apos;Learning Curves&apos;)
</code></pre><p><img src="https://sudl-blog-oss.oss-cn-hangzhou.aliyuncs.com/1535448525816output_32_1.png" alt="png"></p>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">sudl</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
    
        <a href="/2018/08/26/329.找出所有可能的完整二叉树/" class="next-post btn btn-default" title='所有可能的完整二叉树'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">所有可能的完整二叉树</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
<div id="lv-container" data-id="city" data-uid="MTAyMC8zMzA1MS85NjEz">
  <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];
         if (typeof LivereTower === 'function') { return; }
         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;
         e.parentNode.insertBefore(j, e);
     })(document, 'script');
  </script>
</div>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ҫ��"><span class="toc-text">Ҫ��</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#notMNIST-����"><span class="toc-text">notMNIST ����</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#����-1-չʾһЩͼ��"><span class="toc-text">���� 1: չʾһЩͼ��</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ͼ������ת����-3D-����"><span class="toc-text">ͼ������ת���� 3D ����</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#����-2-��֤��һ����ͼ��"><span class="toc-text">���� 2: ��֤��һ����ͼ��</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#����-3-��֤����ƽ��"><span class="toc-text">���� 3: ��֤����ƽ��</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#������ݼ�����"><span class="toc-text">������ݼ�����</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#����-4-������������֤"><span class="toc-text">���� 4: ������������֤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#����-5-Ѱ���ص�����"><span class="toc-text">���� 5: Ѱ���ص�����</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#����-6-ѵ��һ���򵥵L���ѧϰg��"><span class="toc-text">���� 6: ѵ��һ���򵥵Ļ���ѧϰģ��</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2017
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>